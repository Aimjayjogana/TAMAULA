{% extends "base.html" %}

{% block title %}Tournament Management - TAMAULA{% endblock %}

{% block content %}
<div class="dashboard-content">
    <div class="dashboard-header">
        <h1>Tournament Management</h1>
        <p>Create and manage football tournaments</p>
    </div>

    <!-- Create Tournament Form -->
    <div class="form-container" style="margin-bottom: 2rem;">
        <h3>Create New Tournament</h3>
        <form id="createTournamentForm">
            <div class="form-group">
                <label for="name">Tournament Name *</label>
                <input type="text" id="name" name="name" class="form-control" required 
                       placeholder="e.g., Kano State Cup 2024">
            </div>
            
            <div class="form-group">
                <label for="description">Description</label>
                <textarea id="description" name="description" class="form-control" rows="3"
                         placeholder="Tournament description..."></textarea>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <div class="form-group">
                    <label for="competition_id">Competition</label>
                    <select id="competition_id" name="competition_id" class="form-control">
                        <option value="">Select Competition (Optional)</option>
                        {% for competition in competitions %}
                        <option value="{{ competition.id }}">{{ competition.name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label for="tournament_type">Tournament Type *</label>
                    <select id="tournament_type" name="tournament_type" class="form-control" required>
                        <option value="">Select Type</option>
                        <option value="knockout">Knockout</option>
                        <option value="group_stage">Group Stage</option>
                        <option value="combined">Group + Knockout</option>
                    </select>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
                <div class="form-group">
                    <label for="max_teams">Max Teams *</label>
                    <select id="max_teams" name="max_teams" class="form-control" required>
                        <option value="4">4 Teams</option>
                        <option value="8">8 Teams</option>
                        <option value="16">16 Teams</option>
                        <option value="32">32 Teams</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="start_date">Start Date *</label>
                    <input type="date" id="start_date" name="start_date" class="form-control" required>
                </div>

                <div class="form-group">
                    <label for="end_date">End Date *</label>
                    <input type="date" id="end_date" name="end_date" class="form-control" required>
                </div>
            </div>

            <div class="form-group">
                <label for="registration_deadline">Registration Deadline *</label>
                <input type="date" id="registration_deadline" name="registration_deadline" class="form-control" required>
            </div>

            <button type="submit" class="btn">Create Tournament</button>
        </form>
    </div>

    <!-- Tournaments List -->
    <h3>All Tournaments</h3>
    <div class="table-container">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Tournament Name</th>
                    <th>Type</th>
                    <th>Competition</th>
                    <th>Teams</th>
                    <th>Dates</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for tournament in tournaments %}
                <tr>
                    <td>
                        <strong>{{ tournament.name }}</strong>
                        {% if tournament.description %}
                        <br><small style="color: var(--gray);">{{ tournament.description }}</small>
                        {% endif %}
                    </td>
                    <td>{{ tournament.tournament_type|replace('_', ' ')|title }}</td>
                    <td>{{ tournament.competition_name or 'Standalone' }}</td>
                    <td>{{ tournament.participant_count }}/{{ tournament.max_teams }}</td>
                    <td>
                        {{ tournament.start_date }} to {{ tournament.end_date }}
                    </td>
                    <td>
                        <span style="color: {% if tournament.status == 'completed' %}green
                                          {% elif tournament.status == 'ongoing' %}orange
                                          {% else %}blue{% endif %};">
                            {{ tournament.status|title }}
                        </span>
                    </td>
                    <td>
                        <a href="{{ url_for('tournament_details', tournament_id=tournament.id) }}" 
                           class="btn" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">
                            View
                        </a>
                        <button class="btn manage-tournament" data-tournament-id="{{ tournament.id }}"
                                style="padding: 0.25rem 0.5rem; font-size: 0.8rem; background: var(--accent);">
                            Manage
                        </button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
document.getElementById('createTournamentForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    
    fetch('{{ url_for("create_tournament") }}', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('✅ ' + data.message);
            location.reload();
        } else {
            alert('❌ ' + data.message);
        }
    })
    .catch(error => {
        alert('❌ Error: ' + error.message);
    });
});

// Set minimum dates
const today = new Date().toISOString().split('T')[0];
document.getElementById('start_date').min = today;
document.getElementById('end_date').min = today;
document.getElementById('registration_deadline').min = today;
</script>
{% endblock %}