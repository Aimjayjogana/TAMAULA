{% extends "base.html" %}

{% block title %}Clubs - TAMAULA{% endblock %}

{% block content %}
<div class="dashboard-content">
    <div class="dashboard-header">
        <h1>Clubs Directory</h1>
        <p>Find and explore all registered football clubs</p>
    </div>

    <!-- Search Bar -->
    <div class="search-container" style="margin-bottom: 2rem;">
        <div class="form-group">
            <input type="text" id="clubSearch" class="form-control" 
                   placeholder="Search clubs by name or local government...">
        </div>
    </div>

    <!-- Clubs Grid -->
    <div class="card-grid" id="clubsGrid">
        {% for club in clubs %}
        <div class="card club-card" 
             data-name="{{ club.name.lower() }}" 
             data-localgov="{{ club.local_government.lower() }}">
            <div style="text-align: center; margin-bottom: 1rem;">
                <img src="{{ club.logo or url_for('static', filename='images/default-club.png') }}" 
                     alt="{{ club.name }} Logo" 
                     style="width: 100px; height: 100px; object-fit: cover; border-radius: 50%; border: 3px solid var(--primary);"
                     onerror="this.src='{{ url_for('static', filename='images/default-club.png') }}'">
            </div>
            
            <h3>{{ club.name }}</h3>
            <p><strong>Local Government:</strong> {{ club.local_government }}</p>
            <p><strong>Email:</strong> {{ club.email }}</p>
            <p><strong>Phone:</strong> {{ club.phone if club.phone else 'N/A' }}</p>
            <p><strong>Registered:</strong> {{ club.registration_date[:10] }}</p>
            
            
        </div>
        {% endfor %}
    </div>

    <!-- No Results Message -->
    <div id="noClubsResults" style="display: none; text-align: center; padding: 2rem;">
        <h3>No clubs found</h3>
        <p>Try adjusting your search terms</p>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('clubSearch');
    const clubsGrid = document.getElementById('clubsGrid');
    const clubCards = document.querySelectorAll('.club-card');
    const noResults = document.getElementById('noClubsResults');

    searchInput.addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase().trim();
        let visibleCount = 0;

        clubCards.forEach(card => {
            const name = card.getAttribute('data-name');
            const localgov = card.getAttribute('data-localgov');
            
            const matches = name.includes(searchTerm) || localgov.includes(searchTerm);

            if (matches || searchTerm === '') {
                card.style.display = 'block';
                visibleCount++;
                
                // Highlight matching text
                if (searchTerm) {
                    highlightClubText(card, searchTerm);
                } else {
                    removeClubHighlights(card);
                }
            } else {
                card.style.display = 'none';
                removeClubHighlights(card);
            }
        });

        // Show/hide no results message
        if (visibleCount === 0 && searchTerm !== '') {
            noResults.style.display = 'block';
            clubsGrid.style.display = 'none';
        } else {
            noResults.style.display = 'none';
            clubsGrid.style.display = 'grid';
        }
    });

    function highlightClubText(element, searchTerm) {
        const textElements = element.querySelectorAll('h3, p');
        
        textElements.forEach(textElement => {
            const originalText = textElement.textContent;
            const regex = new RegExp(`(${searchTerm})`, 'gi');
            const highlightedText = originalText.replace(regex, '<span class="highlight">$1</span>');
            textElement.innerHTML = highlightedText;
        });
    }

    function removeClubHighlights(element) {
        const highlightedElements = element.querySelectorAll('.highlight');
        highlightedElements.forEach(highlight => {
            const parent = highlight.parentNode;
            parent.replaceChild(document.createTextNode(highlight.textContent), highlight);
            parent.normalize();
        });
    }
});
</script>
{% endblock %}